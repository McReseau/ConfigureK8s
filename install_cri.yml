---
- name: Ensure apt list dir exists
  file:
    path: /var/lib/apt/lists
    state: directory
    mode: 0755
- name: update of repos
  apt:
    update_cache: yes
- name: install containerd
  apt: 
    name: containerd
    state: present
- name: Ensure directory /etc/containerd exist
  file: 
    path: /etc/containerd
    recurse: yes
    state: directory
- name: Generate default configuration
  shell: sudo containerd config default > /etc/containerd/config.toml
- name: Restart containerd 
  block:
  - name: restart using systemd module
    systemd:
      name: containerd.service
      state: restarted
      enabled: yes
  rescue:
  - name: using command caused echec of previous task
    command: systemctl restart containerd
- name: install transport-https
  apt: 
    name: 
      - apt-transport-https
      - curl
    state: present
